---
- project-template:
    name: sf-ci-jobs
    check:
      jobs:
        - sf-rpm-build
        - sf-ci-functional-minimal:
            dependencies:
              - sf-rpm-build
        - sf-ci-upgrade-minimal:
            dependencies:
              - sf-rpm-build
        # - sf-ci-functional-allinone:
        #     dependencies:
        #       - sf-rpm-build
        # - sf-ci-upgrade-allinone:
        #     dependencies:
        #       - sf-rpm-build
        # - sf-ci-functional-external-elk:
        #     dependencies:
        #       - sf-rpm-build
        #     files:
        #       - ^ansible/roles/sf-elasticsearch/.*$
        #       - ^ansible/roles/sf-kibana/.*$
        #       - ^ansible/roles/sf-logstash/.*$
        #       - ^defaults/sfconfig.yaml$
        #       - ^playbooks/multinode-elasticsearch.yaml$
        #       - ^roles/configure-external-elasticsearch-host/.*$
        # - sf-tenants:
        #     dependencies:
        #       - sf-rpm-build
    gate:
      queue: sf-master
      jobs:
        - sf-rpm-build
        - sf-ci-functional-minimal:
            dependencies:
              - sf-rpm-build
        - sf-ci-upgrade-minimal:
            dependencies:
              - sf-rpm-build
        - sf-ci-functional-allinone:
            dependencies:
              - sf-rpm-build
        - sf-ci-upgrade-allinone:
            dependencies:
              - sf-rpm-build
        - sf-ci-functional-external-elk:
            dependencies:
              - sf-rpm-build
            files:
              - ^ansible/roles/sf-elasticsearch/.*$
              - ^ansible/roles/sf-kibana/.*$
              - ^ansible/roles/sf-logstash/.*$
              - ^defaults/sfconfig.yaml$
              - ^playbooks/multinode-elasticsearch.yaml$
              - ^roles/configure-external-elasticsearch-host/.*$
        - wait-for-changes-ahead:
            dependencies:
              - name: sf-ci-functional-minimal
              - name: sf-ci-upgrade-minimal
              - name: sf-ci-functional-allinone
              - name: sf-ci-functional-external-elk
                soft: true
              - name: sf-ci-upgrade-allinone

- project-template:
    name: sf-ci-jobs-light
    check:
      jobs:
        - sf-rpm-build
    gate:
      queue: sf-master
      jobs:
        - sf-rpm-build
        - sf-ci-functional-allinone:
            dependencies:
              - sf-rpm-build
        - sf-ci-upgrade-allinone:
            dependencies:
              - sf-rpm-build
        - wait-for-changes-ahead:
            dependencies:
              - sf-ci-functional-allinone
              - sf-ci-upgrade-allinone

- project-template:
    name: sf-ci-no-jobs
    check:
      jobs:
        - noop
    gate:
      queue: sf-master
      jobs:
        - sf-rpm-build
        - wait-for-changes-ahead:
            dependencies:
              - sf-rpm-build

- project-template:
    name: sf-ci-packages-publish
    gate:
      jobs:
        - sf-rpm-publish:
            dependencies:
              - wait-for-changes-ahead
    release:
      jobs:
        - sf-rpm-publish

- project-template:
    name: sf-ci-python-jobs
    check:
      jobs:
        - tox-pep8
        - tox-py27
    gate:
      queue: sf-master
      jobs:
        - tox-pep8
        - tox-py27

- project-template:
    name: sf-ci-noop
    check:
      jobs:
        - noop
    gate:
      jobs:
        - noop
