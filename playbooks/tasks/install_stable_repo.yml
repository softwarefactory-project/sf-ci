- name: "Fix diskimage-builder rpm-distro element (see: https://review.openstack.org/568180)"
  copy:
    content: centos
    dest: /etc/yum/vars/contentdir
  become: yes

- name: Check for zuul-built.repo
  stat: path=/etc/yum.repos.d/zuul-built.repo
  register: zuul_built_repo

- name: Check for local-built.repo
  stat: path=/etc/yum.repos.d/local-built.repo
  register: local_built_repo

- name: Save zuul-built.repo
  command: mv /etc/yum.repos.d/zuul-built.repo /root/
  when: zuul_built_repo.stat.exists
  become: yes

- name: Save local-built.repo
  command: mv /etc/yum.repos.d/local-built.repo /root
  when: local_built_repo.stat.exists
  become: yes

- name: Install stable repo
  yum:
    name: https://softwarefactory-project.io/repos/sf-release-{{ sf_version }}.rpm
    validate_certs: no
    state: present
  become: yes
