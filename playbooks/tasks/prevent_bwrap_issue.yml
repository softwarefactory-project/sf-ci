---
# See https://github.com/projectatomic/bubblewrap/issues/273
#- name: Get how many time /srv/host-rootfs is mounted
#  shell: mount | grep /srv/host-rootfs | wc -l
#  register: rootfs

- name: Ensure /srv/host-rootfs is not double mounted
  block:
    - name: Umount /srv/host-rootfs
      shell: while true; do umount -l /srv/host-rootfs || break; done; cat /proc/mounts; mount -a
      ignore_errors: yes

    - name: Get /etc/fstab content
      command: cat /etc/fstab
      register: fstab_content

    - debug:
        var: fstab_content

    - name: Get mounted devices
      command: cat /proc/mounts
      register: mounted_devices

    - debug:
        var: mounted_devices
#    - name: Restart rh-python35-nodepool-launcher
#      systemd:
#        name: rh-python35-nodepool-launcher
#        state: restarted
  become: yes
#  when: rootfs.stdout != "1"
