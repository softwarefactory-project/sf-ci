---
- hosts: localhost
  become_method: sudo
  tasks:
    - block:
      - include: tasks/prepare_test_env.yml
      - include: tasks/install_sf_ci_repo.yml
      - include: tasks/yum_update.yml
      - include: tasks/install_test_env.yml
      - include: tasks/run_sfconfig.yml
      - include: tasks/run_serverspec.yml
      - include: tasks/run_provisioner.yml
      - include: tasks/run_backup_create.yml
      - include: tasks/run_health-check.yml
      - include: tasks/run_firehose_listener.yml
      - include: tasks/run_functional_tests.yml
      - include: tasks/check_firehose_events.yml
      - include: tasks/run_erase.yml
      - include: tasks/run_sfconfig_recover.yml
      - include: tasks/run_checker.yml
      always:
      - include: tasks/finish_test.yml
