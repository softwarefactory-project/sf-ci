---
- hosts: install-server
  vars:
    artifacts: "{{ ansible_env.HOME }}/artifacts"
    sf_user: "zuul-worker"
  tasks:
    - name: Ensure artifacts directory exists
      file:
        path: "{{ artifacts }}"
        state: directory

    - include: tasks/finish_test.yml

    - name: Evaluate artifacts variable to prevent lookup on the executor host
      set_fact:
        artifacts: "{{ artifacts }}"

    - name: Fetch artifacts
      synchronize:
        src: "{{ artifacts }}/"
        dest: "{{ zuul.executor.log_root }}/artifacts/"
        mode: pull
