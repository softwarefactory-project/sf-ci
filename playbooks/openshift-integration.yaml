---
- hosts: install-server
  tasks:
    - name: Prepare instance
      include_role:
        name: '{{ item }}'
      loop:
        - prepare-test-env
        - install-mirrors
        - update-system
        - install-sfconfig

    - name: Configure sfconfig
      include_role:
        name: configure-sfconfig
      vars:
        add_component:
          - component: hypervisor-openshift
            insertafter: nodepool-launcher

    - name: Configure hostname and fqdn
      include_role:
        name: configure-fqdn

    - name: Run sfconfig with provision-demo
      include_role:
        name: run-sfconfig
      vars:
        sfconfig_args: --provision-demo

    - name: Run health-check
      include_role:
        name: run-health-check
