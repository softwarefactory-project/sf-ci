- name: "Update sfconfig.yaml"
  become: yes
  command: |
    python -c 'import yaml
    import sys
    f = open("/etc/software-factory/sfconfig.yaml", "r")
    conf = yaml.safe_load(f)
    conf["fqdn"] = "{{ sf_domain }}"
    conf["authentication"]["oauth2"]["github"]["disabled"] = False
    conf["authentication"]["oauth2"]["github"]["client_id"] = "{{ github_app_id }}"
    conf["authentication"]["oauth2"]["github"]["client_secret"] = "{{ github_app_secret }}"
    conf["authentication"]["oauth2"]["google"]["disabled"] = False
    conf["authentication"]["oauth2"]["google"]["client_id"] = "{{ google_app_id }}"
    conf["authentication"]["oauth2"]["google"]["client_secret"] = "{{ google_app_secret }}"
    conf["authentication"]["oauth2"]["bitbucket"]["disabled"] = False
    conf["authentication"]["oauth2"]["bitbucket"]["client_id"] = "{{ bitbucket_app_id }}"
    conf["authentication"]["oauth2"]["bitbucket"]["client_secret"] = "{{ bitbucket_app_secret }}"
    conf["nodepool"]["providers"] = [{
        "name": "default",
        "auth_url": "{{ os_auth_url }}",
        "username": "{{ os_username }}",
        "password": "{{ os_password }}",
        "project_name": "{{ os_tenant_name }}",
    }]
    conf["nodepool3"]["providers"] = [{
        "name": "default",
        "auth_url": "{{ os_auth_url }}",
        "username": "{{ os_username }}",
        "password": "{{ os_password }}",
        "project_name": "{{ os_tenant_name }}",
    }]
    f = open("/etc/software-factory/sfconfig.yaml", "w")
    yaml.dump(conf, f, default_flow_style=False)
    f.close()'

- name: "Copy logo"
  become: yes
  copy:
    src: files/logo.png
    dest: "{{ item }}"
  with_items:
    - /etc/software-factory/logo-splash.png
    - /etc/software-factory/logo-topmenu.png

