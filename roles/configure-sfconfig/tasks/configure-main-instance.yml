- name: Configure worker instance
  block:
    - name: Remove default value for gerrit_connections in sfconfig.yaml
      lineinfile:
        path: /etc/software-factory/sfconfig.yaml
        regexp: '^  gerrit_connections:.*'
        line: '  gerrit_connections:'

    - name: Add worker gerrit connection
      blockinfile:
        path: /etc/software-factory/sfconfig.yaml
        insertafter: '^  gerrit_connections:$'
        marker: "# {mark} ANSIBLE MANAGED BLOCK gerrit connection"
        block: |2
            - name: gerrit-worker
              hostname: worker.sftests.com
              port: 29418
              puburl: https://worker.sftests.com/r/
              username: zuul
              # TODO update doc
              default_pipelines: false
