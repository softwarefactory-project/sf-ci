- name: Install sfinfo repo
  command: >
    ./software-factory/sfinfo/zuul_rpm_setup.py
        --distro-info ./software-factory/sfinfo/sf-{{ zuul.branch }}.yaml
        {{ sfinfo_setup_args }}
  args:
    chdir: "{{ sfnamespace_path }}"
  become: yes

- name: Install sf-master repositories
  include_tasks: install_master_mirror.yml
  when: sf_version == 'master' or update_mirrors

- name: Install sf-stable repositories
  include_tasks: install_stable_mirror.yml
  when: sf_version != 'master'

- name: Install RPM-GPG-KEY-CentOS-SIG-SCLo-python35
  copy:
    src: files/RPM-GPG-KEY-CentOS-SIG-SCLo-python35
    dest: /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo-python35
  become: yes

- name: Ensure rh-python35-mirror repo is installed
  yum_repository:
    name: "arh-python35-mirror"
    description: "SF python35 mirror"
    baseurl: "https://softwarefactory-project.io/mirrors/rh-python35/"
    gpgcheck: "1"
    gpgkey: "file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo-python35"
    enabled: "1"
    file: "/etc/yum.repos.d/sf-release"
  become: yes
