---
- name: Remove empty directories
  command: "find {{ artifacts }} -type d -empty -delete"

- name: Dump journalctl all logs to the file
  shell: |
    set timeout 60
    journalctl --output short --no-pager --since='1 day ago' | tee /tmp/journalctl.log
  become: true
  no_log: true

- name: Fetch artifacts
  synchronize:
    src: "{{ artifacts }}/"
    dest: "{{ zuul.executor.log_root }}/logs"
    mode: pull
  become: yes

- name: Fetch job artifacts
  synchronize:
    src: /var/www/logs
    dest: "{{ zuul.executor.log_root }}/job-logs"
    mode: pull
  no_log: True

- name: Fetch nodepool launcher logs
  synchronize:
    src: /var/log/nodepool
    dest: "{{ zuul.executor.log_root }}/nodepool"
    mode: pull
  no_log: True
  become: yes

- name: Fetch journalctl log file
  synchronize:
    src: /tmp/journalctl.log
    dest: "{{ zuul.executor.log_root }}/logs"
    mode: pull
  no_log: True
  become: yes
