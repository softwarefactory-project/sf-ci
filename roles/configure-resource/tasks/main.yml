- name: Ensure /root/config is clean
  command: '{{ item }}'
  args:
    chdir: /root/config
  loop:
    - git fetch --all
    - git reset --hard origin/master --
    - git clean -f -x -d

- name: Add tenant gerrit connection
  blockinfile:
    path: /root/config/resources/tenant-sftests.com.yaml
    create: yes
    block: |
      resources:
        tenants:
          tenant-sftests.com:
            description: "The new tenant"
            url: "https://tenant-sftests.com/manage"
            default-connection: tenant-sftests.com

- name: Push resources configuration
  command: '{{ item }}'
  args:
    chdir: /root/config
  loop:
    - git add resources/tenant-sftests.com.yaml
    - git commit -m 'Create tenant resource'
    - git push git+ssh://gerrit/config master

